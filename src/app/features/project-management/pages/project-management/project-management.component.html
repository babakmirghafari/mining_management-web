<div class="page" dir="rtl">
  <!-- Header -->
  <div class="page-header">
    <div>
      <h1 class="page-title">
        {{ currentUser?.role === 'admin' ? 'Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§' : 'Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ù†' }}
      </h1>
      <p class="page-subtitle">Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø¹Ø¯Ù† Ùˆ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ù¾ÛŒØ´Ø±ÙØª</p>
    </div>
    @if (currentUser?.role === 'admin') {
      <button class="btn btn-primary" (click)="openAddDialog()">
        â• Ù¾Ø±ÙˆÚ˜Ù‡ Ø¬Ø¯ÛŒØ¯
      </button>
    }
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-card-body">
        <div>
          <p class="stat-label">Ú©Ù„ Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§</p>
          <p class="stat-value">{{ totalProjects }}</p>
        </div>
        <span class="stat-icon">ğŸ—ï¸</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-card-body">
        <div>
          <p class="stat-label">Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„</p>
          <p class="stat-value">{{ activeCount }}</p>
        </div>
        <span class="stat-icon">ğŸš€</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-card-body">
        <div>
          <p class="stat-label">ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡</p>
          <p class="stat-value">{{ completedCount }}</p>
        </div>
        <span class="stat-icon">âœ…</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-card-body">
        <div>
          <p class="stat-label">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù¾ÛŒØ´Ø±ÙØª</p>
          <p class="stat-value">{{ avgProgress }}%</p>
        </div>
        <span class="stat-icon">ğŸ“Š</span>
      </div>
    </div>
  </div>

  <!-- Projects Table -->
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">Ù„ÛŒØ³Øª Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§</h3>
    </div>
    <div class="card-content">
      <div class="table-wrapper">
        <table class="table">
          <thead>
            <tr>
              <th>Ù†Ø§Ù… Ù¾Ø±ÙˆÚ˜Ù‡</th>
              <th>Ù…ÙˆÙ‚Ø¹ÛŒØª</th>
              <th>ÙˆØ¶Ø¹ÛŒØª</th>
              <th>Ù¾ÛŒØ´Ø±ÙØª</th>
              <th>ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹</th>
              <th>ØªØ§Ø±ÛŒØ® Ù¾Ø§ÛŒØ§Ù†</th>
              <th>Ø¨ÙˆØ¯Ø¬Ù‡</th>
              <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
            </tr>
          </thead>
          <tbody>
            @for (project of filteredProjects; track project.id) {
              <tr>
                <td class="font-medium">{{ project.name }}</td>
                <td class="text-sm">ğŸ“ {{ project.location }}</td>
                <td>
                  <span [class]="'badge ' + getStatusInfo(project.status).color">
                    {{ getStatusInfo(project.status).label }}
                  </span>
                </td>
                <td>
                  <div class="progress-cell">
                    <div class="progress-bar-sm">
                      <div class="progress-bar-fill" [style.width.%]="project.progress"></div>
                    </div>
                    <span class="progress-text">{{ project.progress }}%</span>
                  </div>
                </td>
                <td class="text-sm">ğŸ“… {{ project.startDate }}</td>
                <td class="text-sm">{{ project.endDate }}</td>
                <td class="text-sm">{{ project.budget ? formatCurrency(project.budget) : '-' }}</td>
                <td>
                  <div class="actions">
                    @if (currentUser?.role === 'admin') {
                      <button class="btn btn-sm btn-outline" (click)="openEditDialog(project)" title="ÙˆÛŒØ±Ø§ÛŒØ´">
                        âœï¸
                      </button>
                      <button class="btn btn-sm btn-outline btn-danger" (click)="deleteProject(project.id)" title="Ø­Ø°Ù">
                        ğŸ—‘ï¸
                      </button>
                    }
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Dialog -->
  @if (isDialogOpen) {
    <div class="dialog-overlay" (click)="closeDialog()">
      <div class="dialog" (click)="$event.stopPropagation()" dir="rtl">
        <div class="dialog-header">
          <h3>{{ selectedProject ? 'ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾Ø±ÙˆÚ˜Ù‡' : 'Ø§ÙØ²ÙˆØ¯Ù† Ù¾Ø±ÙˆÚ˜Ù‡ Ø¬Ø¯ÛŒØ¯' }}</h3>
          <p class="dialog-desc">
            {{ selectedProject ? 'Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø±ÙˆÚ˜Ù‡ Ø±Ø§ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ù†ÛŒØ¯' : 'Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø±ÙˆÚ˜Ù‡ Ø¬Ø¯ÛŒØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯' }}
          </p>
        </div>
        <form (ngSubmit)="handleSubmit()">
          <div class="form-group">
            <label>Ù†Ø§Ù… Ù¾Ø±ÙˆÚ˜Ù‡</label>
            <input type="text" [(ngModel)]="formData.name" name="name" required />
          </div>
          <div class="form-group">
            <label>ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
            <textarea [(ngModel)]="formData.description" name="description" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label>Ù…ÙˆÙ‚Ø¹ÛŒØª</label>
            <input type="text" [(ngModel)]="formData.location" name="location" required />
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹</label>
              <input type="text" [(ngModel)]="formData.startDate" name="startDate" placeholder="1403/01/01" required />
            </div>
            <div class="form-group">
              <label>ØªØ§Ø±ÛŒØ® Ù¾Ø§ÛŒØ§Ù†</label>
              <input type="text" [(ngModel)]="formData.endDate" name="endDate" placeholder="1403/12/30" required />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>ÙˆØ¶Ø¹ÛŒØª</label>
              <select [(ngModel)]="formData.status" name="status">
                @for (status of projectStatuses; track status.value) {
                  <option [value]="status.value">{{ status.label }}</option>
                }
              </select>
            </div>
            <div class="form-group">
              <label>Ø¨ÙˆØ¯Ø¬Ù‡ (Ø±ÛŒØ§Ù„)</label>
              <input type="number" [(ngModel)]="formData.budget" name="budget" />
            </div>
          </div>
          <div class="dialog-actions">
            <button type="button" class="btn btn-outline" (click)="closeDialog()">Ø§Ù†ØµØ±Ø§Ù</button>
            <button type="submit" class="btn btn-primary">
              {{ selectedProject ? 'ÙˆÛŒØ±Ø§ÛŒØ´' : 'Ø§ÙØ²ÙˆØ¯Ù†' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  }
</div>
