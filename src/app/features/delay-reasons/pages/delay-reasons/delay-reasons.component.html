<div class="page" dir="rtl">
  <!-- Header -->
  <div class="page-header">
    <div>
      <h1 class="page-title">{{ 'feature.delay_reasons.title' | translate }}</h1>
      <p class="page-subtitle">{{ 'feature.delay_reasons.title_desc' | translate }}</p>
    </div>
    <button class="btn btn-primary" (click)="openAddDialog()">
      â• Ø¯Ù„ÛŒÙ„ ØªØ§Ø®ÛŒØ± Ø¬Ø¯ÛŒØ¯
    </button>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-card-body">
        <div>
          <p class="stat-label">Ú©Ù„ Ø¯Ù„Ø§ÛŒÙ„</p>
          <p class="stat-value">{{ stats.total }}</p>
        </div>
        <span class="stat-icon">ğŸ“‹</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-card-body">
        <div>
          <p class="stat-label">ÙØ¹Ø§Ù„</p>
          <p class="stat-value text-green">{{ stats.active }}</p>
        </div>
        <span class="stat-icon">âœ…</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-card-body">
        <div>
          <p class="stat-label">ØºÛŒØ±ÙØ¹Ø§Ù„</p>
          <p class="stat-value text-gray">{{ stats.inactive }}</p>
        </div>
        <span class="stat-icon">â¸ï¸</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-card-body">
        <div>
          <p class="stat-label">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</p>
          <p class="stat-value text-purple">{{ stats.categories }}</p>
        </div>
        <span class="stat-icon">ğŸ·ï¸</span>
      </div>
    </div>
  </div>

  <!-- Active Reasons Table -->
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">Ø¯Ù„Ø§ÛŒÙ„ ØªØ§Ø®ÛŒØ± ÙØ¹Ø§Ù„</h3>
    </div>
    <div class="card-content">
      <div class="table-wrapper">
        <table class="table">
          <thead>
            <tr>
              <th>Ù†Ø§Ù…</th>
              <th>Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</th>
              <th>ØªÙˆØ¶ÛŒØ­Ø§Øª</th>
              <th>Ø±Ù†Ú¯</th>
              <th>ØªØ§Ø±ÛŒØ® Ø§ÛŒØ¬Ø§Ø¯</th>
              <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
            </tr>
          </thead>
          <tbody>
            @for (reason of activeReasons; track reason.id) {
              <tr>
                <td class="font-medium">{{ reason.name }}</td>
                <td>
                  <span class="badge category-badge" [style.background]="getCategoryInfo(reason.category).color">
                    {{ getCategoryInfo(reason.category).label }}
                  </span>
                </td>
                <td class="text-sm text-muted">{{ truncateDescription(reason.description) }}</td>
                <td>
                  <div class="color-cell">
                    <span class="color-swatch" [style.background]="reason.color || '#ccc'"></span>
                    <span class="text-xs text-muted">{{ reason.color || '-' }}</span>
                  </div>
                </td>
                <td class="text-sm">{{ reason.createdAt }}</td>
                <td>
                  <div class="actions">
                    <button class="btn btn-sm btn-outline" (click)="openEditDialog(reason)" title="ÙˆÛŒØ±Ø§ÛŒØ´">âœï¸</button>
                    <button class="btn btn-sm btn-outline btn-danger" (click)="deleteReason(reason.id)" title="Ø­Ø°Ù">ğŸ—‘ï¸</button>
                  </div>
                </td>
              </tr>
            }
            @if (activeReasons.length === 0) {
              <tr>
                <td colspan="6" class="empty-state">Ù‡ÛŒÚ† Ø¯Ù„ÛŒÙ„ ØªØ§Ø®ÛŒØ± ÙØ¹Ø§Ù„ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Inactive Reasons Table -->
  @if (inactiveReasons.length > 0) {
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">Ø¯Ù„Ø§ÛŒÙ„ ØªØ§Ø®ÛŒØ± ØºÛŒØ±ÙØ¹Ø§Ù„</h3>
      </div>
      <div class="card-content">
        <div class="table-wrapper">
          <table class="table">
            <thead>
              <tr>
                <th>Ù†Ø§Ù…</th>
                <th>Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</th>
                <th>ØªÙˆØ¶ÛŒØ­Ø§Øª</th>
                <th>Ø±Ù†Ú¯</th>
                <th>ØªØ§Ø±ÛŒØ® Ø§ÛŒØ¬Ø§Ø¯</th>
                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
              </tr>
            </thead>
            <tbody>
              @for (reason of inactiveReasons; track reason.id) {
                <tr class="row-inactive">
                  <td class="font-medium">{{ reason.name }}</td>
                  <td>
                    <span class="badge category-badge" [style.background]="getCategoryInfo(reason.category).color" [style.opacity]="0.6">
                      {{ getCategoryInfo(reason.category).label }}
                    </span>
                  </td>
                  <td class="text-sm text-muted">{{ truncateDescription(reason.description) }}</td>
                  <td>
                    <div class="color-cell">
                      <span class="color-swatch" [style.background]="reason.color || '#ccc'"></span>
                      <span class="text-xs text-muted">{{ reason.color || '-' }}</span>
                    </div>
                  </td>
                  <td class="text-sm">{{ reason.createdAt }}</td>
                  <td>
                    <div class="actions">
                      <button class="btn btn-sm btn-outline" (click)="openEditDialog(reason)" title="ÙˆÛŒØ±Ø§ÛŒØ´">âœï¸</button>
                      <button class="btn btn-sm btn-outline btn-danger" (click)="deleteReason(reason.id)" title="Ø­Ø°Ù">ğŸ—‘ï¸</button>
                    </div>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    </div>
  }

  <!-- Category Breakdown -->
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">ØªÙÚ©ÛŒÚ© Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</h3>
    </div>
    <div class="card-content">
      <div class="category-grid">
        @for (item of categoryBreakdown; track item.info.key) {
          <div class="category-card" [style.border-right-color]="item.info.color">
            <div class="category-card-header">
              <span class="category-dot" [style.background]="item.info.color"></span>
              <span class="category-name">{{ item.info.label }}</span>
              <span class="category-count">{{ item.count }}</span>
            </div>
            <div class="category-card-body">
              @for (reason of item.reasons; track reason.id) {
                <div class="category-reason-item">
                  <span class="reason-name-sm">{{ reason.name }}</span>
                  @if (reason.isActive) {
                    <span class="badge-sm badge-active">ÙØ¹Ø§Ù„</span>
                  } @else {
                    <span class="badge-sm badge-inactive">ØºÛŒØ±ÙØ¹Ø§Ù„</span>
                  }
                </div>
              }
            </div>
          </div>
        }
      </div>
    </div>
  </div>

  <!-- Create / Edit Dialog -->
  @if (isDialogOpen) {
    <div class="dialog-overlay" (click)="closeDialog()">
      <div class="dialog" (click)="$event.stopPropagation()" dir="rtl">
        <div class="dialog-header">
          <h3>{{ selectedReason ? 'ÙˆÛŒØ±Ø§ÛŒØ´ Ø¯Ù„ÛŒÙ„ ØªØ§Ø®ÛŒØ±' : 'Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ù„ÛŒÙ„ ØªØ§Ø®ÛŒØ± Ø¬Ø¯ÛŒØ¯' }}</h3>
          <p class="dialog-desc">
            {{ selectedReason ? 'Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ù„ÛŒÙ„ ØªØ§Ø®ÛŒØ± Ø±Ø§ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ù†ÛŒØ¯' : 'Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ù„ÛŒÙ„ ØªØ§Ø®ÛŒØ± Ø¬Ø¯ÛŒØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯' }}
          </p>
        </div>
        <form (ngSubmit)="handleSubmit()">
          <div class="form-group">
            <label>Ù†Ø§Ù…</label>
            <input type="text" [(ngModel)]="formData.name" name="name" required placeholder="Ù†Ø§Ù… Ø¯Ù„ÛŒÙ„ ØªØ§Ø®ÛŒØ±" />
          </div>
          <div class="form-group">
            <label>Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</label>
            <select [(ngModel)]="formData.category" name="category">
              @for (cat of categories; track cat.key) {
                <option [value]="cat.key">{{ cat.label }}</option>
              }
            </select>
          </div>
          <div class="form-group">
            <label>ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
            <textarea [(ngModel)]="formData.description" name="description" rows="3" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ ØªØ§Ø®ÛŒØ±"></textarea>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Ø±Ù†Ú¯</label>
              <div class="color-input-wrap">
                <input type="color" [(ngModel)]="formData.color" name="color" class="color-picker" />
                <input type="text" [(ngModel)]="formData.color" name="colorText" class="color-text" placeholder="#FF5733" />
              </div>
            </div>
            <div class="form-group">
              <label class="checkbox-label-wrap">
                <input type="checkbox" [(ngModel)]="formData.isActive" name="isActive" />
                <span>ÙØ¹Ø§Ù„</span>
              </label>
            </div>
          </div>
          <div class="dialog-actions">
            <button type="button" class="btn btn-outline" (click)="closeDialog()">Ø§Ù†ØµØ±Ø§Ù</button>
            <button type="submit" class="btn btn-primary">
              {{ selectedReason ? 'ÙˆÛŒØ±Ø§ÛŒØ´' : 'Ø§ÙØ²ÙˆØ¯Ù†' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  }
</div>
