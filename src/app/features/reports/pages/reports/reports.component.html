<div class="page" dir="rtl">
  <!-- Header -->
  <div class="page-header">
    <div>
      <h1 class="page-title">{{ 'feature.reports.title' | translate }}</h1>
      <p class="page-subtitle">{{ 'feature.reports.title_desc' | translate }}</p>
    </div>
  </div>

  <!-- Filters Card -->
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">ğŸ” ÙÛŒÙ„ØªØ±Ù‡Ø§</h3>
    </div>
    <div class="card-content">
      <div class="filters-grid">
        <div class="form-group">
          <label>Ù†ÙˆØ¹ Ú¯Ø²Ø§Ø±Ø´</label>
          <select [(ngModel)]="selectedReportType">
            @for (rt of reportTypes; track rt.value) {
              <option [value]="rt.value">{{ rt.label }}</option>
            }
          </select>
        </div>
        <div class="form-group">
          <label>Ù¾Ø±ÙˆÚ˜Ù‡</label>
          <select [(ngModel)]="selectedProjectId">
            <option value="">Ù‡Ù…Ù‡ Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§</option>
            @for (p of projects; track p.id) {
              <option [value]="p.id">{{ p.name }}</option>
            }
          </select>
        </div>
        <div class="form-group">
          <label>Ø§Ø² ØªØ§Ø±ÛŒØ®</label>
          <input type="text" [(ngModel)]="dateFrom" placeholder="Û±Û´Û°Û³/Û°Û±/Û°Û±" />
        </div>
        <div class="form-group">
          <label>ØªØ§ ØªØ§Ø±ÛŒØ®</label>
          <input type="text" [(ngModel)]="dateTo" placeholder="Û±Û´Û°Û³/Û°Û¶/Û³Û±" />
        </div>
      </div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs-bar">
    @for (tab of tabs; track tab.key) {
      <button
        class="tab-btn"
        [class.tab-active]="activeTab === tab.key"
        (click)="activeTab = tab.key">
        {{ tab.icon }} {{ tab.label }}
      </button>
    }
  </div>

  <!-- ===================== TAB 1: Performance ===================== -->
  @if (activeTab === 'performance') {
    <!-- Summary Stats -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-card-body">
          <div>
            <p class="stat-label">Ú©Ù„ Ø¨Ø±Ù†Ø§Ù…Ù‡</p>
            <p class="stat-value text-blue">{{ totalPlanned.toLocaleString() }}</p>
          </div>
          <span class="stat-icon">ğŸ“‹</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-card-body">
          <div>
            <p class="stat-label">Ú©Ù„ ØªØ­Ù‚Ù‚</p>
            <p class="stat-value text-green">{{ totalAchieved.toLocaleString() }}</p>
          </div>
          <span class="stat-icon">âœ…</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-card-body">
          <div>
            <p class="stat-label">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø±Ø§Ù†Ø¯Ù…Ø§Ù†</p>
            <p class="stat-value text-purple">{{ avgEfficiency }}%</p>
          </div>
          <span class="stat-icon">ğŸ“Š</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-card-body">
          <div>
            <p class="stat-label">ØªØ¹Ø¯Ø§Ø¯ Ø±Ú©ÙˆØ±Ø¯</p>
            <p class="stat-value">{{ totalRecords }}</p>
          </div>
          <span class="stat-icon">ğŸ“</span>
        </div>
      </div>
    </div>

    <!-- Monthly Performance Table -->
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">ğŸ“… Ø¹Ù…Ù„Ú©Ø±Ø¯ Ù…Ø§Ù‡Ø§Ù†Ù‡</h3>
      </div>
      <div class="card-content">
        <div class="table-wrapper">
          <table class="table">
            <thead>
              <tr>
                <th>Ù…Ø§Ù‡</th>
                <th>Ø¨Ø±Ù†Ø§Ù…Ù‡</th>
                <th>ØªØ­Ù‚Ù‚</th>
                <th>Ù¾ÛŒØ´Ø±ÙØª</th>
                <th>Ø±Ø§Ù†Ø¯Ù…Ø§Ù†</th>
                <th>Ø±ÙˆÙ†Ø¯</th>
              </tr>
            </thead>
            <tbody>
              @for (m of monthlyData; track m.month; let i = $index) {
                <tr>
                  <td class="font-medium">{{ m.month }}</td>
                  <td>{{ m.planned.toLocaleString() }}</td>
                  <td>{{ m.achieved.toLocaleString() }}</td>
                  <td>
                    <div class="progress-cell">
                      <div class="progress-bar">
                        <div
                          class="progress-bar-fill"
                          [class.fill-green]="m.efficiency >= 95"
                          [class.fill-blue]="m.efficiency >= 90 && m.efficiency < 95"
                          [class.fill-yellow]="m.efficiency >= 80 && m.efficiency < 90"
                          [class.fill-red]="m.efficiency < 80"
                          [style.width.%]="m.efficiency">
                        </div>
                      </div>
                      <span class="progress-text">{{ m.efficiency }}%</span>
                    </div>
                  </td>
                  <td>
                    <span [class]="'eff-badge ' + getEfficiencyClass(m.efficiency)">
                      {{ m.efficiency }}%
                    </span>
                  </td>
                  <td>
                    <span [class]="'trend-indicator ' + getMonthTrendClass(i)">
                      {{ getMonthTrend(i) }}
                    </span>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    </div>
  }

  <!-- ===================== TAB 2: Data Table ===================== -->
  @if (activeTab === 'data-table') {
    <!-- Monthly Data Table -->
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">ğŸ“… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù‡Ø§Ù†Ù‡</h3>
      </div>
      <div class="card-content">
        <div class="table-wrapper">
          <table class="table">
            <thead>
              <tr>
                <th>Ø±Ø¯ÛŒÙ</th>
                <th>Ù…Ø§Ù‡</th>
                <th>Ø¨Ø±Ù†Ø§Ù…Ù‡</th>
                <th>ØªØ­Ù‚Ù‚</th>
                <th>Ù¾ÛŒØ´Ø±ÙØª</th>
                <th>Ø±Ø§Ù†Ø¯Ù…Ø§Ù†</th>
                <th>ÙˆØ¶Ø¹ÛŒØª</th>
              </tr>
            </thead>
            <tbody>
              @for (m of monthlyData; track m.month; let i = $index) {
                <tr>
                  <td class="text-muted">{{ i + 1 }}</td>
                  <td class="font-medium">{{ m.month }}</td>
                  <td>{{ m.planned.toLocaleString() }}</td>
                  <td>{{ m.achieved.toLocaleString() }}</td>
                  <td>
                    <div class="progress-cell">
                      <div class="progress-bar">
                        <div
                          class="progress-bar-fill"
                          [class.fill-green]="m.efficiency >= 95"
                          [class.fill-blue]="m.efficiency >= 90 && m.efficiency < 95"
                          [class.fill-yellow]="m.efficiency >= 80 && m.efficiency < 90"
                          [class.fill-red]="m.efficiency < 80"
                          [style.width.%]="m.efficiency">
                        </div>
                      </div>
                      <span class="progress-text">{{ m.efficiency }}%</span>
                    </div>
                  </td>
                  <td>
                    <span [class]="'eff-badge ' + getEfficiencyClass(m.efficiency)">
                      {{ m.efficiency }}%
                    </span>
                  </td>
                  <td>
                    <span [class]="'badge ' + getStatusBadgeClass(m.efficiency)">
                      {{ getStatusBadge(m.efficiency) }}
                    </span>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Daily Data Table -->
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">ğŸ“‹ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡</h3>
      </div>
      <div class="card-content">
        <div class="table-wrapper">
          <table class="table">
            <thead>
              <tr>
                <th>Ø±Ø¯ÛŒÙ</th>
                <th>ØªØ§Ø±ÛŒØ®</th>
                <th>Ø¨Ø±Ù†Ø§Ù…Ù‡</th>
                <th>ØªØ­Ù‚Ù‚</th>
                <th>Ù¾ÛŒØ´Ø±ÙØª</th>
                <th>Ø±Ø§Ù†Ø¯Ù…Ø§Ù†</th>
                <th>ÙˆØ¶Ø¹ÛŒØª</th>
              </tr>
            </thead>
            <tbody>
              @for (d of dailyEfficiencyData; track d.date; let i = $index) {
                <tr>
                  <td class="text-muted">{{ i + 1 }}</td>
                  <td class="font-medium">{{ d.date }}</td>
                  <td>{{ d.planned.toLocaleString() }}</td>
                  <td>{{ d.achieved.toLocaleString() }}</td>
                  <td>
                    <div class="progress-cell">
                      <div class="progress-bar">
                        <div
                          class="progress-bar-fill"
                          [class.fill-green]="d.efficiency >= 95"
                          [class.fill-blue]="d.efficiency >= 90 && d.efficiency < 95"
                          [class.fill-yellow]="d.efficiency >= 80 && d.efficiency < 90"
                          [class.fill-red]="d.efficiency < 80"
                          [style.width.%]="Math.min(d.efficiency, 100)">
                        </div>
                      </div>
                      <span class="progress-text">{{ d.efficiency }}%</span>
                    </div>
                  </td>
                  <td>
                    <span [class]="'eff-badge ' + getEfficiencyClass(d.efficiency)">
                      {{ d.efficiency }}%
                    </span>
                  </td>
                  <td>
                    <span [class]="'badge ' + getStatusBadgeClass(d.efficiency)">
                      {{ getStatusBadge(d.efficiency) }}
                    </span>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    </div>
  }

  <!-- ===================== TAB 3: Variance ===================== -->
  @if (activeTab === 'variance') {
    <!-- Variance Stats -->
    <div class="stats-grid stats-grid-3">
      <div class="stat-card">
        <div class="stat-card-body">
          <div>
            <p class="stat-label">Ú©Ù„ Ø§Ù†Ø­Ø±Ø§ÙØ§Øª</p>
            <p class="stat-value text-yellow">12</p>
          </div>
          <span class="stat-icon">ğŸ“‰</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-card-body">
          <div>
            <p class="stat-label">Ø§Ù†Ø­Ø±Ø§ÙØ§Øª Ø¨Ø­Ø±Ø§Ù†ÛŒ</p>
            <p class="stat-value text-red">3</p>
          </div>
          <span class="stat-icon">ğŸš¨</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-card-body">
          <div>
            <p class="stat-label">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ú©Ø§Ù‡Ø´</p>
            <p class="stat-value text-orange">15%</p>
          </div>
          <span class="stat-icon">âš ï¸</span>
        </div>
      </div>
    </div>

    <!-- Variance Table -->
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">ğŸ“Š Ø¬Ø¯ÙˆÙ„ Ø§Ù†Ø­Ø±Ø§ÙØ§Øª</h3>
      </div>
      <div class="card-content">
        <div class="table-wrapper">
          <table class="table">
            <thead>
              <tr>
                <th>Ø±Ø¯ÛŒÙ</th>
                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                <th>Ø¨Ø±Ù†Ø§Ù…Ù‡</th>
                <th>ØªØ­Ù‚Ù‚</th>
                <th>Ø§Ù†Ø­Ø±Ø§Ù</th>
                <th>Ø¯Ø±ØµØ¯ Ø§Ù†Ø­Ø±Ø§Ù</th>
                <th>Ø´Ø¯Øª</th>
              </tr>
            </thead>
            <tbody>
              @for (v of varianceData; track v.id) {
                <tr>
                  <td class="text-muted">{{ v.id }}</td>
                  <td class="font-medium">{{ v.operation }}</td>
                  <td>{{ v.planned.toLocaleString() }}</td>
                  <td>{{ v.achieved.toLocaleString() }}</td>
                  <td class="text-red font-medium">{{ v.variance.toLocaleString() }}</td>
                  <td>
                    <div class="progress-cell">
                      <div class="progress-bar progress-bar-variance">
                        <div
                          class="progress-bar-fill fill-red"
                          [style.width.%]="Math.abs(v.variancePercent)">
                        </div>
                      </div>
                      <span class="progress-text text-red">{{ v.variancePercent }}%</span>
                    </div>
                  </td>
                  <td>
                    <span [class]="'badge ' + getSeverityClass(v.severity)">
                      {{ getSeverityLabel(v.severity) }}
                    </span>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    </div>
  }

  <!-- ===================== TAB 4: Equipment ===================== -->
  @if (activeTab === 'equipment') {
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">ğŸš› Ø¹Ù…Ù„Ú©Ø±Ø¯ ØªØ¬Ù‡ÛŒØ²Ø§Øª</h3>
      </div>
      <div class="card-content">
        <div class="table-wrapper">
          <table class="table">
            <thead>
              <tr>
                <th>Ø±Ø¯ÛŒÙ</th>
                <th>Ù†Ø§Ù… ØªØ¬Ù‡ÛŒØ²</th>
                <th>Ø³Ø§Ø¹Ø§Øª Ø¨Ø±Ù†Ø§Ù…Ù‡</th>
                <th>Ø³Ø§Ø¹Ø§Øª ÙˆØ§Ù‚Ø¹ÛŒ</th>
                <th>Ù¾ÛŒØ´Ø±ÙØª</th>
                <th>Ø±Ø§Ù†Ø¯Ù…Ø§Ù†</th>
                <th>ÙˆØ¶Ø¹ÛŒØª</th>
              </tr>
            </thead>
            <tbody>
              @for (eq of equipmentPerformance; track eq.name; let i = $index) {
                <tr>
                  <td class="text-muted">{{ i + 1 }}</td>
                  <td class="font-medium">{{ eq.name }}</td>
                  <td>{{ eq.hoursPlanned }} Ø³Ø§Ø¹Øª</td>
                  <td>{{ eq.hoursActual }} Ø³Ø§Ø¹Øª</td>
                  <td>
                    <div class="progress-cell">
                      <div class="progress-bar">
                        <div
                          class="progress-bar-fill"
                          [class.fill-green]="eq.efficiency >= 95"
                          [class.fill-blue]="eq.efficiency >= 90 && eq.efficiency < 95"
                          [class.fill-yellow]="eq.efficiency >= 80 && eq.efficiency < 90"
                          [class.fill-red]="eq.efficiency < 80"
                          [style.width.%]="eq.efficiency">
                        </div>
                      </div>
                      <span class="progress-text">{{ eq.efficiency }}%</span>
                    </div>
                  </td>
                  <td>
                    <span [class]="'eff-badge ' + getEfficiencyClass(eq.efficiency)">
                      {{ eq.efficiency }}%
                    </span>
                  </td>
                  <td>
                    <span [class]="'badge ' + getStatusBadgeClass(eq.efficiency)">
                      {{ getStatusBadge(eq.efficiency) }}
                    </span>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    </div>
  }

  <!-- ===================== TAB 5: Operators ===================== -->
  @if (activeTab === 'operators') {
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">ğŸ‘· Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø§Ù¾Ø±Ø§ØªÙˆØ±Ù‡Ø§</h3>
      </div>
      <div class="card-content">
        <div class="table-wrapper">
          <table class="table">
            <thead>
              <tr>
                <th>Ø±Ø¯ÛŒÙ</th>
                <th>Ù†Ø§Ù… Ø§Ù¾Ø±Ø§ØªÙˆØ±</th>
                <th>Ø³Ø§Ø¹Ø§Øª Ú©Ø§Ø±ÛŒ</th>
                <th>ØªØ¹Ø¯Ø§Ø¯ Ù¾Ø±ÙˆÚ˜Ù‡</th>
                <th>Ù¾ÛŒØ´Ø±ÙØª</th>
                <th>Ø±Ø§Ù†Ø¯Ù…Ø§Ù†</th>
                <th>Ø±ØªØ¨Ù‡</th>
              </tr>
            </thead>
            <tbody>
              @for (op of operatorPerformance; track op.name; let i = $index) {
                <tr>
                  <td class="text-muted">{{ i + 1 }}</td>
                  <td class="font-medium">{{ op.name }}</td>
                  <td>{{ op.hoursWorked }} Ø³Ø§Ø¹Øª</td>
                  <td>{{ op.projects }}</td>
                  <td>
                    <div class="progress-cell">
                      <div class="progress-bar">
                        <div
                          class="progress-bar-fill"
                          [class.fill-green]="op.efficiency >= 95"
                          [class.fill-blue]="op.efficiency >= 90 && op.efficiency < 95"
                          [class.fill-yellow]="op.efficiency >= 80 && op.efficiency < 90"
                          [class.fill-red]="op.efficiency < 80"
                          [style.width.%]="op.efficiency">
                        </div>
                      </div>
                      <span class="progress-text">{{ op.efficiency }}%</span>
                    </div>
                  </td>
                  <td>
                    <span [class]="'eff-badge ' + getEfficiencyClass(op.efficiency)">
                      {{ op.efficiency }}%
                    </span>
                  </td>
                  <td>
                    <span [class]="'grade-badge ' + getOperatorGradeClass(op.efficiency)">
                      {{ getOperatorGrade(op.efficiency) }}
                    </span>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    </div>
  }

  <!-- ===================== TAB 6: Delays ===================== -->
  @if (activeTab === 'delays') {
    <!-- Delay Reasons Table -->
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">â±ï¸ Ø¯Ù„Ø§ÛŒÙ„ ØªØ£Ø®ÛŒØ±</h3>
      </div>
      <div class="card-content">
        <div class="table-wrapper">
          <table class="table">
            <thead>
              <tr>
                <th>Ø±Ø¯ÛŒÙ</th>
                <th>Ø¯Ù„ÛŒÙ„ ØªØ£Ø®ÛŒØ±</th>
                <th>Ø¯Ø±ØµØ¯</th>
                <th>Ù†Ù…ÙˆØ¯Ø§Ø±</th>
              </tr>
            </thead>
            <tbody>
              @for (d of delayReasons; track d.name; let i = $index) {
                <tr>
                  <td class="text-muted">{{ i + 1 }}</td>
                  <td>
                    <div class="delay-name-cell">
                      <span class="color-swatch" [style.background]="d.color"></span>
                      <span class="font-medium">{{ d.name }}</span>
                    </div>
                  </td>
                  <td class="font-medium">{{ d.value }}%</td>
                  <td>
                    <div class="percentage-bar-wrapper">
                      <div class="percentage-bar" [style.width.%]="d.value" [style.background]="d.color"></div>
                    </div>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>

        <!-- Summary bar -->
        <div class="delay-summary-bar">
          @for (d of delayReasons; track d.name) {
            <div
              class="delay-segment"
              [style.width.%]="d.value"
              [style.background]="d.color"
              [title]="d.name + ': ' + d.value + '%'">
            </div>
          }
        </div>
        <div class="delay-legend">
          @for (d of delayReasons; track d.name) {
            <div class="legend-item">
              <span class="color-swatch-sm" [style.background]="d.color"></span>
              <span class="legend-label">{{ d.name }} ({{ d.value }}%)</span>
            </div>
          }
        </div>
      </div>
    </div>

    <!-- Preventive Actions -->
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">ğŸ›¡ï¸ Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ù¾ÛŒØ´Ú¯ÛŒØ±Ø§Ù†Ù‡</h3>
      </div>
      <div class="card-content">
        <div class="actions-grid">
          @for (action of preventiveActions; track action.title) {
            <div class="action-card">
              <div class="action-icon">{{ action.icon }}</div>
              <h4 class="action-title">{{ action.title }}</h4>
              <p class="action-desc">{{ action.description }}</p>
            </div>
          }
        </div>
      </div>
    </div>
  }
</div>
