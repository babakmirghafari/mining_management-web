<div class="page" dir="rtl">
  <!-- ==================== LIST TAB ==================== -->
  @if (activeTab === 'list') {
    <!-- Header -->
    <div class="page-header">
      <div>
        <h1 class="page-title">{{ 'feature.period_achievements.title' | translate }}</h1>
        <p class="page-subtitle">{{ 'feature.period_achievements.title_desc' | translate }}</p>
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-card-body">
          <div>
            <p class="stat-label">Ú©Ù„ Ø¹Ù…Ù„Ú©Ø±Ø¯Ù‡Ø§</p>
            <p class="stat-value">{{ stats.total }}</p>
          </div>
          <span class="stat-icon">ğŸ“Š</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-card-body">
          <div>
            <p class="stat-label">ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡</p>
            <p class="stat-value text-green">{{ stats.completed }}</p>
          </div>
          <span class="stat-icon">âœ…</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-card-body">
          <div>
            <p class="stat-label">Ø¯Ø± Ù…Ø³ÛŒØ±</p>
            <p class="stat-value text-blue">{{ stats.onTrack }}</p>
          </div>
          <span class="stat-icon">ğŸ“ˆ</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-card-body">
          <div>
            <p class="stat-label">Ø¯Ø± Ø®Ø·Ø±</p>
            <p class="stat-value text-red">{{ stats.atRisk }}</p>
          </div>
          <span class="stat-icon">âš ï¸</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-card-body">
          <div>
            <p class="stat-label">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø¹Ù…Ù„Ú©Ø±Ø¯</p>
            <p class="stat-value text-blue">{{ stats.avgAchievement }}%</p>
          </div>
          <span class="stat-icon">ğŸ“‰</span>
        </div>
      </div>
    </div>

    <!-- Achievements Table -->
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">Ù„ÛŒØ³Øª Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¯ÙˆØ±Ù‡â€ŒØ§ÛŒ</h3>
      </div>
      <div class="card-content">
        <div class="table-wrapper">
          <table class="table">
            <thead>
              <tr>
                <th>Ø¹Ù†ÙˆØ§Ù† Ø¨Ø±Ù†Ø§Ù…Ù‡</th>
                <th>Ù¾Ø±ÙˆÚ˜Ù‡</th>
                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                <th>Ø¯ÙˆØ±Ù‡ / ØªØ§Ø±ÛŒØ®</th>
                <th>Ù…Ù‚Ø¯Ø§Ø± Ø¨Ø±Ù†Ø§Ù…Ù‡</th>
                <th>Ù…Ù‚Ø¯Ø§Ø± Ø¹Ù…Ù„Ú©Ø±Ø¯</th>
                <th>Ø¯Ø±ØµØ¯ Ø¹Ù…Ù„Ú©Ø±Ø¯</th>
                <th>ÙˆØ¶Ø¹ÛŒØª</th>
                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
              </tr>
            </thead>
            <tbody>
              @for (ach of allAchievements; track ach.id) {
                <tr>
                  <td class="font-medium">{{ ach.planTitle }}</td>
                  <td>{{ getProjectName(ach.projectId) }}</td>
                  <td>
                    <span class="badge status-blue">{{ ach.operationName }}</span>
                  </td>
                  <td>
                    <span class="period-label">{{ getPeriodLabel(ach.period) }}</span>
                    <span class="text-muted text-sm">{{ ach.startDate }} â€” {{ ach.endDate }}</span>
                  </td>
                  <td>{{ ach.totalPlanned }}</td>
                  <td>{{ ach.totalAchieved }}</td>
                  <td>
                    <span [class]="'achievement-badge ' + getAchievementClass(ach.overallAchievement)">
                      {{ ach.overallAchievement }}%
                    </span>
                  </td>
                  <td>
                    <span [class]="'badge ' + getOverallStatusInfo(ach.overallStatus).color">
                      {{ getOverallStatusInfo(ach.overallStatus).label }}
                    </span>
                  </td>
                  <td>
                    <button class="btn btn-sm btn-primary" (click)="selectAchievement(ach)">
                      Ø«Ø¨Øª Ø¹Ù…Ù„Ú©Ø±Ø¯
                    </button>
                  </td>
                </tr>
              }
              @if (allAchievements.length === 0) {
                <tr>
                  <td colspan="9" class="empty-state">
                    Ø±Ú©ÙˆØ±Ø¯ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¯ÙˆØ±Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    </div>
  }

  <!-- ==================== DETAILS TAB ==================== -->
  @if (activeTab === 'details' && selectedAchievement) {
    <!-- Header -->
    <div class="page-header">
      <div>
        <h1 class="page-title">{{ selectedAchievement.planTitle }}</h1>
        <p class="page-subtitle">
          {{ getProjectName(selectedAchievement.projectId) }} â€” {{ selectedAchievement.operationName }}
        </p>
      </div>
      <div class="header-actions">
        <button class="btn btn-outline" (click)="goBackToList()">
          â†’ Ø¨Ø§Ø²Ú¯Ø´Øª
        </button>
        <button class="btn btn-primary" (click)="saveAchievement()">
          ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ø¹Ù…Ù„Ú©Ø±Ø¯
        </button>
      </div>
    </div>

    <!-- Summary Stats -->
    <div class="summary-grid">
      <div class="summary-card">
        <p class="summary-label">Ù…Ø¬Ù…ÙˆØ¹ Ø¨Ø±Ù†Ø§Ù…Ù‡</p>
        <p class="summary-value">{{ selectedAchievement.totalPlanned }}</p>
      </div>
      <div class="summary-card">
        <p class="summary-label">Ù…Ø¬Ù…ÙˆØ¹ Ø¹Ù…Ù„Ú©Ø±Ø¯</p>
        <p class="summary-value">{{ selectedAchievement.totalAchieved }}</p>
      </div>
      <div class="summary-card">
        <p class="summary-label">Ø¯Ø±ØµØ¯ Ú©Ù„ Ø¹Ù…Ù„Ú©Ø±Ø¯</p>
        <p class="summary-value">
          <span [class]="'achievement-badge ' + getAchievementClass(selectedAchievement.overallAchievement)">
            {{ selectedAchievement.overallAchievement }}%
          </span>
          <span [class]="'badge ms-sm ' + getOverallStatusInfo(selectedAchievement.overallStatus).color">
            {{ getOverallStatusInfo(selectedAchievement.overallStatus).label }}
          </span>
        </p>
      </div>
    </div>

    <!-- Daily Table -->
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø±ÙˆØ²Ø§Ù†Ù‡</h3>
      </div>
      <div class="card-content">
        <div class="table-wrapper">
          <table class="table daily-table">
            <thead>
              <tr>
                <th>ØªØ§Ø±ÛŒØ®</th>
                <th>Ù…Ù‚Ø¯Ø§Ø± Ø¨Ø±Ù†Ø§Ù…Ù‡</th>
                <th>Ù…Ù‚Ø¯Ø§Ø± Ø¹Ù…Ù„Ú©Ø±Ø¯</th>
                <th>Ø¯Ø±ØµØ¯</th>
                <th>ÙˆØ¶Ø¹ÛŒØª</th>
                <th>Ø¯Ù„Ø§ÛŒÙ„ ØªØ£Ø®ÛŒØ±</th>
                <th>ÛŒØ§Ø¯Ø¯Ø§Ø´Øª</th>
              </tr>
            </thead>
            <tbody>
              @for (day of selectedAchievement.days; track trackByIndex($index); let i = $index) {
                <tr [class.holiday-row]="day.isHoliday">
                  <td>
                    <span class="day-date">{{ day.date }}</span>
                    @if (day.isHoliday) {
                      <span class="badge status-holiday">ØªØ¹Ø·ÛŒÙ„</span>
                    }
                  </td>
                  <td>{{ day.plannedAmount }}</td>
                  <td>
                    <input
                      type="number"
                      class="day-input"
                      [(ngModel)]="day.achievedAmount"
                      [name]="'achieved_' + i"
                      [disabled]="!!day.isHoliday"
                      (ngModelChange)="onAchievedAmountChange(i)"
                      min="0" />
                  </td>
                  <td>
                    <span [class]="'achievement-badge ' + getAchievementClass(day.achievementPercentage)">
                      {{ day.achievementPercentage }}%
                    </span>
                  </td>
                  <td>
                    <select
                      class="day-select"
                      [(ngModel)]="day.status"
                      [name]="'status_' + i">
                      @for (st of dayStatuses; track st.value) {
                        <option [value]="st.value">{{ st.label }}</option>
                      }
                    </select>
                  </td>
                  <td>
                    <div class="delay-cell">
                      <div class="delay-checkboxes">
                        @for (reason of delayReasonOptions; track reason) {
                          <label class="checkbox-label-sm">
                            <input
                              type="checkbox"
                              [checked]="isDelayReasonSelected(day, reason)"
                              (change)="toggleDelayReason(day, reason)" />
                            {{ reason }}
                          </label>
                        }
                      </div>
                      <textarea
                        class="delay-desc"
                        [(ngModel)]="day.delayDescription"
                        [name]="'delayDesc_' + i"
                        rows="2"
                        placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª ØªØ£Ø®ÛŒØ±"></textarea>
                    </div>
                  </td>
                  <td>
                    <textarea
                      class="notes-input"
                      [(ngModel)]="day.notes"
                      [name]="'notes_' + i"
                      rows="2"
                      placeholder="ÛŒØ§Ø¯Ø¯Ø§Ø´Øª"></textarea>
                  </td>
                </tr>
              }
              @if (selectedAchievement.days.length === 0) {
                <tr>
                  <td colspan="7" class="empty-state">
                    Ø±ÙˆØ²ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Bottom save -->
    <div class="form-actions">
      <button class="btn btn-outline" (click)="goBackToList()">Ø§Ù†ØµØ±Ø§Ù</button>
      <button class="btn btn-primary" (click)="saveAchievement()">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ø¹Ù…Ù„Ú©Ø±Ø¯</button>
    </div>
  }
</div>
